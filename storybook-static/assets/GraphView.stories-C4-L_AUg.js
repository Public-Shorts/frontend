import{p as U,s as N,w as Q,x as X,o as Y,ae as F,f as S,b as _,a as W,l as i,A as g,j,z as q,c as H,k as x,i as Z}from"./iframe-6KIpb0Mt.js";import{c as $,d as ee}from"./create-runtime-stories-C7cqMwQp.js";import{_ as te}from"./preload-helper-PPVm8Dsz.js";import{b as ae}from"./this-DkeGxGfh.js";import{d as ie}from"./graphUtils-aBi1ZnmZ.js";import{f as R,G as E}from"./client-8ns0aL8_.js";var oe=S('<div class="h-full w-full"></div>');function V(L,f){U(f,!0);let u=N(void 0),n=N(null),p=N(Q(new Set)),T=new Set;X(async()=>{const a=(await te(()=>import("./force-graph-CBTrLi6B.js"),[],import.meta.url)).default;k(a)}),Y(()=>{i(n)&&(i(n)._destructor?.(),g(n,null))});function k(e){if(!i(u))return;g(n,e()(i(u)).graphData({nodes:[],links:[]}).nodeId("id").nodeVal("val").nodeLabel("").backgroundColor("#f9f7f5").nodeVisibility(t=>t.visible!==!1).linkVisibility(t=>{const s=typeof t.source=="object"?t.source.id:t.source,o=typeof t.target=="object"?t.target.id:t.target,d=i(n)?.graphData();if(!d)return!0;const l=d.nodes.find(m=>m.id===s),c=d.nodes.find(m=>m.id===o);return!(l?.visible===!1||c?.visible===!1||l?.type!=="film"&&l?.active===!1||c?.type!=="film"&&c?.active===!1)}).linkColor(t=>{const s=typeof t.source=="object"?t.source.id:t.source,o=typeof t.target=="object"?t.target.id:t.target,d=f.graphData.nodes.find(m=>m.id===s),l=f.graphData.nodes.find(m=>m.id===o),c=d?.active!==!1&&l?.active!==!1;return i(p).size>0?i(p).has(s)&&i(p).has(o)?G(t.type,.7):"rgba(0,0,0,0.03)":G(t.type,c?.25:.06)}).linkWidth(t=>{if(i(p).size>0){const s=typeof t.source=="object"?t.source.id:t.source,o=typeof t.target=="object"?t.target.id:t.target;return i(p).has(s)&&i(p).has(o)?1.5:.2}return .5}).nodeCanvasObject((t,s,o)=>{P(t,s,o)}).nodePointerAreaPaint((t,s,o)=>{const d=M(t)+2;o.beginPath(),o.arc(t.x,t.y,d,0,2*Math.PI),o.fillStyle=s,o.fill()}).onNodeHover(t=>{if(i(u)&&(i(u).style.cursor=t?"pointer":"default"),t){const s=new Set([t.id]),o=i(n).graphData();for(const l of o.links){const c=typeof l.source=="object"?l.source.id:l.source,m=typeof l.target=="object"?l.target.id:l.target;c===t.id&&s.add(m),m===t.id&&s.add(c)}g(p,s,!0);const d=i(u)?.querySelector("canvas");if(d){const l=d.getBoundingClientRect(),c=i(n).graph2ScreenCoords(t.x,t.y);f.onNodeHover(t,{x:l.left+c.x,y:l.top+c.y})}}else g(p,new Set,!0),f.onNodeHover(null,{x:0,y:0})}).onNodeClick(t=>{f.onNodeClick(t)}).onBackgroundClick(()=>{g(p,new Set,!0)}).warmupTicks(0).cooldownTicks(400).d3AlphaDecay(.04).d3VelocityDecay(.6),!0),i(n).d3Force("charge").strength(-60),i(n).d3Force("link").distance(50);const a=I(.06);i(n).d3Force("gravity",a),f.graphData.nodes.length>0&&(T=new Set(f.graphData.nodes.map(t=>t.id)),i(n).graphData({nodes:f.graphData.nodes,links:f.graphData.links}),setTimeout(()=>i(n).zoomToFit(400,60),500));const r=new ResizeObserver(()=>{i(n)&&i(u)&&i(n).width(i(u).clientWidth).height(i(u).clientHeight)});return r.observe(i(u)),()=>r.disconnect()}function I(e){let a=[];function r(t){for(const s of a)s.vx-=s.x*e*t,s.vy-=s.y*e*t}return r.initialize=t=>{a=t},r}function G(e,a){switch(e){case"film-meta":return`rgba(204, 70, 0, ${a})`;case"film-cluster":return`rgba(124, 58, 237, ${a})`;case"film-screening":return`rgba(234, 179, 8, ${a})`;default:return`rgba(69, 65, 61, ${a})`}}function M(e){return Math.sqrt(e.val||2)*3}function P(e,a,r){const t=M(e),s=e.active!==!1,o=i(p).size===0||i(p).has(e.id),d=!s||!o,l=d?ie(e.color,.2):e.color;a.beginPath(),e.type==="meta-category"?O(a,e.x-t,e.y-t,t*2,t*2,3):e.type==="cluster"?D(a,e.x,e.y,t):e.type==="screening"?w(a,e.x,e.y,t):a.arc(e.x,e.y,t,0,2*Math.PI),a.fillStyle=l,a.fill(),!d&&(e.type==="meta-category"||e.type==="cluster"||e.type==="screening")&&(a.shadowColor=e.color,a.shadowBlur=8,a.fill(),a.shadowBlur=0);const c=f.displayOptions.labelMode;if(c==="always"||c==="hover"&&(i(p).has(e.id)||e.type!=="film")){const C=Math.max(9,11/r);a.font=`${C}px sans-serif`,a.textAlign="center",a.textBaseline="top",a.fillStyle=d?"rgba(69,65,61,0.25)":"rgba(69,65,61,0.85)",a.fillText(e.label,e.x,e.y+t+3/r)}}function O(e,a,r,t,s,o){e.moveTo(a+o,r),e.lineTo(a+t-o,r),e.quadraticCurveTo(a+t,r,a+t,r+o),e.lineTo(a+t,r+s-o),e.quadraticCurveTo(a+t,r+s,a+t-o,r+s),e.lineTo(a+o,r+s),e.quadraticCurveTo(a,r+s,a,r+s-o),e.lineTo(a,r+o),e.quadraticCurveTo(a,r,a+o,r),e.closePath()}function D(e,a,r,t){e.moveTo(a,r-t),e.lineTo(a+t,r),e.lineTo(a,r+t),e.lineTo(a-t,r),e.closePath()}function w(e,a,r,t){e.moveTo(a,r-t),e.lineTo(a+t*.866,r+t*.5),e.lineTo(a-t*.866,r+t*.5),e.closePath()}F(()=>{if(!i(n)||!f.graphData)return;const e=new Set(f.graphData.nodes.map(r=>r.id));if(e.size!==T.size||[...e].some(r=>!T.has(r))){const r=i(n).graphData(),t=new Map;for(const o of r.nodes)o.x!=null&&o.y!=null&&t.set(o.id,{x:o.x,y:o.y});const s=f.graphData.nodes.map(o=>{const d=t.get(o.id);if(d)return{...o,x:d.x,y:d.y,vx:0,vy:0};const l=f.graphData.links.find(c=>{const m=typeof c.source=="string"?c.source:c.source.id,C=typeof c.target=="string"?c.target:c.target.id;return m===o.id||C===o.id});if(l){const c=typeof l.source=="string"?l.source:l.source.id,m=typeof l.target=="string"?l.target:l.target.id,C=c===o.id?m:c,z=t.get(C);if(z){const A=Math.random()*2*Math.PI;return{...o,x:z.x+Math.cos(A)*30,y:z.y+Math.sin(A)*30,vx:0,vy:0}}}return{...o}});T=e,i(n).graphData({nodes:s,links:f.graphData.links})}else{const r=i(n).graphData(),t=new Map(f.graphData.nodes.map(s=>[s.id,s]));for(const s of r.nodes){const o=t.get(s.id);o&&(s.visible=o.visible,s.active=o.active,s.val=o.val,s.color=o.color)}i(n).nodeVisibility(i(n).nodeVisibility()),i(n).linkVisibility(i(n).linkVisibility())}}),F(()=>{i(n)&&(i(n).d3Force("charge").strength(-60*f.displayOptions.forceStrength),i(n).d3ReheatSimulation())}),F(()=>{i(n)&&(i(p),i(n).nodeColor(i(n).nodeColor()))});function b(){i(n)&&i(n).zoomToFit(400,60)}function v(){const e=i(u)?.querySelector("canvas");return e?e.toDataURL("image/png"):null}var h={zoomToFit:b,exportImage:v},y=oe();return ae(y,e=>g(u,e),()=>i(u)),_(L,y),W(h)}V.__docgen={data:[{name:"graphData",visibility:"public",keywords:[{name:"required",description:""}],kind:"let",type:{kind:"type",type:"object",text:"GraphData"},static:!1,readonly:!1},{name:"displayOptions",visibility:"public",keywords:[{name:"required",description:""}],kind:"let",type:{kind:"type",type:"object",text:"DisplayOptions"},static:!1,readonly:!1},{name:"onNodeHover",visibility:"public",keywords:[{name:"required",description:""}],kind:"let",type:{kind:"function",text:"(node: GraphNode | null, pos: { x: number; y: number; }) => void"},static:!1,readonly:!1},{name:"onNodeClick",visibility:"public",keywords:[{name:"required",description:""}],kind:"let",type:{kind:"function",text:"(node: GraphNode) => void"},static:!1,readonly:!1}],name:"GraphView.svelte"};const re={title:"Visualiser/GraphView",component:V},{Story:B}=ee();var se=S('<div class="relative" style="height: 500px;"><!> <!></div>'),ne=S('<p class="p-4 text-sm text-gallery-400">Loading from Sanity...</p>'),le=S("<!> <!>",1),ce=S('<p class="p-4 text-sm text-red-500">No data found</p>'),de=S('<div class="relative" style="height: 500px;"><!></div>'),fe=S("<!> <!>",1);function J(L,f){U(f,!0);let u=N(null),n=N(Q({x:0,y:0}));const p={sizeMode:"connections",labelMode:"hover",forceStrength:10,filterMode:"union",showMetaCategories:!0,showClusters:!0,showScreenings:!0},T={nodes:[{id:"f1",type:"film",label:"Dawn Chorus",val:3,color:"#857f7a",active:!0,visible:!0,data:{englishTitle:"Dawn Chorus",directorName:"Alice Martin",length:12,slug:"dawn-chorus"}},{id:"f2",type:"film",label:"Concrete Lullaby",val:2,color:"#857f7a",active:!0,visible:!0,data:{englishTitle:"Concrete Lullaby",directorName:"Bob Chen",length:8,slug:"concrete-lullaby"}},{id:"f3",type:"film",label:"After the Rain",val:2,color:"#857f7a",active:!0,visible:!0,data:{englishTitle:"After the Rain",directorName:"Clara Dias",length:15,slug:"after-the-rain"}},{id:"f4",type:"film",label:"Quiet Machines",val:1.5,color:"#857f7a",active:!0,visible:!0,data:{englishTitle:"Quiet Machines",directorName:"Dan Erickson",length:6,slug:"quiet-machines"}},{id:"f5",type:"film",label:"Still Life",val:1.5,color:"#857f7a",active:!1,visible:!0,data:{englishTitle:"Still Life",directorName:"Eva Fernandez",length:10,slug:"still-life"}},{id:"mc-1",type:"meta-category",label:"Documentary",val:6,color:"#ff7411",active:!0,visible:!0,data:{name:"Documentary",filmCount:3}},{id:"mc-2",type:"meta-category",label:"Experimental",val:4,color:"#ff7411",active:!0,visible:!0,data:{name:"Experimental",filmCount:2}},{id:"cl-1",type:"cluster",label:"Urban Landscapes",val:5,color:"#8b5cf6",active:!0,visible:!0,data:{name:"Urban Landscapes",filmCount:3}}],links:[{source:"f1",target:"mc-1",type:"film-meta"},{source:"f2",target:"mc-1",type:"film-meta"},{source:"f3",target:"mc-1",type:"film-meta"},{source:"f1",target:"mc-2",type:"film-meta"},{source:"f4",target:"mc-2",type:"film-meta"},{source:"f2",target:"cl-1",type:"film-cluster"},{source:"f3",target:"cl-1",type:"film-cluster"},{source:"f5",target:"cl-1",type:"film-cluster"}],activeFilmIds:new Set(["f1","f2","f3","f4"])};let k=N(null),I=N(!1);async function G(){const[D,w,b]=await Promise.all([R('*[_type == "tvSelection"][0].films[].film->{ _id, englishTitle, directorName, length }[0..19]'),R('*[_type == "metaCategory"]{ _id, name, "filmIds": films[].film._ref }'),R('*[_type == "semanticCluster"]{ _id, name, "filmIds": [...highlightedFilms[]._ref, ...relevantFilms[]._ref] }')]);if(!D?.length){g(I,!0);return}const v=new Set(D.map(e=>e._id)),h=[],y=[];for(const e of D)h.push({id:e._id,type:"film",label:e.englishTitle,val:2,color:"#857f7a",active:!0,visible:!0,data:{englishTitle:e.englishTitle,directorName:e.directorName,length:e.length}});for(const e of w??[]){const a=(e.filmIds??[]).filter(r=>v.has(r));if(a.length!==0){h.push({id:`mc-${e._id}`,type:"meta-category",label:e.name,val:6,color:"#ff7411",active:!0,visible:!0,data:{name:e.name,filmCount:a.length}});for(const r of a)y.push({source:r,target:`mc-${e._id}`,type:"film-meta"})}}for(const e of b??[]){const a=[...new Set((e.filmIds??[]).filter(r=>v.has(r)))];if(a.length!==0){h.push({id:`cl-${e._id}`,type:"cluster",label:e.name,val:5,color:"#8b5cf6",active:!0,visible:!0,data:{name:e.name,filmCount:a.length}});for(const r of a)y.push({source:r,target:`cl-${e._id}`,type:"film-cluster"})}}g(k,{nodes:h,links:y,activeFilmIds:v},!0),g(I,!0)}G();var M=fe(),P=j(M);B(P,{name:"Default",template:w=>{var b=se(),v=H(b);V(v,{get graphData(){return T},get displayOptions(){return p},onNodeHover:(y,e)=>{g(u,y,!0),g(n,e,!0)},onNodeClick:()=>{}});var h=q(v,2);E(h,{get node(){return i(u)},get x(){return i(n).x},get y(){return i(n).y}}),_(w,b)},$$slots:{template:!0},parameters:{__svelteCsf:{rawCode:`<div class="relative" style="height: 500px;">
	<GraphView
		graphData={mockGraphData}
		displayOptions={mockDisplayOptions}
		onNodeHover={(node, pos) => { hoveredNode = node; mousePos = pos; }}
		onNodeClick={() => {}}
	/>
	<GraphTooltip node={hoveredNode} x={mousePos.x} y={mousePos.y} />
</div>`}}});var O=q(P,2);B(O,{name:"Sanity Data",template:w=>{var b=de(),v=H(b);{var h=e=>{var a=ne();_(e,a)},y=e=>{var a=Z(),r=j(a);{var t=o=>{var d=le(),l=j(d);V(l,{get graphData(){return i(k)},get displayOptions(){return p},onNodeHover:(m,C)=>{g(u,m,!0),g(n,C,!0)},onNodeClick:()=>{}});var c=q(l,2);E(c,{get node(){return i(u)},get x(){return i(n).x},get y(){return i(n).y}}),_(o,d)},s=o=>{var d=ce();_(o,d)};x(r,o=>{i(k)?o(t):o(s,!1)},!0)}_(e,a)};x(v,e=>{i(I)?e(y,!1):e(h)})}_(w,b)},$$slots:{template:!0},parameters:{__svelteCsf:{rawCode:`<div class="relative" style="height: 500px;">
	{#if !sanityLoaded}
		<p class="p-4 text-sm text-gallery-400">Loading from Sanity...</p>
	{:else if sanityGraphData}
		<GraphView
			graphData={sanityGraphData}
			displayOptions={mockDisplayOptions}
			onNodeHover={(node, pos) => { hoveredNode = node; mousePos = pos; }}
			onNodeClick={() => {}}
		/>
		<GraphTooltip node={hoveredNode} x={mousePos.x} y={mousePos.y} />
	{:else}
		<p class="p-4 text-sm text-red-500">No data found</p>
	{/if}
</div>`}}}),_(L,M),W()}J.__docgen={data:[],name:"GraphView.stories.svelte"};const K=$(J,re),ye=["Default","SanityData"],be={...K.Default,tags:["svelte-csf-v5"]},_e={...K.SanityData,tags:["svelte-csf-v5"]};export{be as Default,_e as SanityData,ye as __namedExportsOrder,re as default};
