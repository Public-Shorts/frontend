import{_ as k}from"./preload-helper-PPVm8Dsz.js";import{p as q,s as h,w as F,x as M,o as V,ae as z,f as G,b as H,a as A,l as r,A as p,aV as y}from"./iframe-6KIpb0Mt.js";import{b as B}from"./this-DkeGxGfh.js";import{d as R}from"./graphUtils-aBi1ZnmZ.js";var L=G('<div class="h-full w-full"></div>');function E(w,g){q(g,!0);let u=h(void 0),l=h(null),c=h(F(new Set));M(async()=>{const i=(await k(()=>import("./force-graph-CBTrLi6B.js"),[],import.meta.url)).default;C(i)}),V(()=>{r(l)&&(r(l)._destructor?.(),p(l,null))});function C(t){if(!r(u))return;p(l,t()(r(u)).graphData({nodes:[],links:[]}).nodeId("id").nodeVal("val").nodeLabel("").backgroundColor("rgba(0,0,0,0)").nodeVisibility(e=>e.visible!==!1).linkVisibility(e=>{const o=typeof e.source=="object"?e.source.id:e.source,s=typeof e.target=="object"?e.target.id:e.target,n=r(l)?.graphData();if(!n)return!0;const d=n.nodes.find(m=>m.id===o),f=n.nodes.find(m=>m.id===s);return!(d?.visible===!1||f?.visible===!1)}).linkColor(e=>{const o=typeof e.source=="object"?e.source.id:e.source,s=typeof e.target=="object"?e.target.id:e.target;return r(c).size>0?r(c).has(o)&&r(c).has(s)?b(e.type,.7):"rgba(0,0,0,0.03)":b(e.type,.25)}).linkWidth(e=>{if(r(c).size>0){const o=typeof e.source=="object"?e.source.id:e.source,s=typeof e.target=="object"?e.target.id:e.target;return r(c).has(o)&&r(c).has(s)?1.5:.2}return .5}).nodeCanvasObject((e,o,s)=>{D(e,o,s)}).nodePointerAreaPaint((e,o,s)=>{const n=v(e)+2;s.beginPath(),s.arc(e.x,e.y,n,0,2*Math.PI),s.fillStyle=o,s.fill()}).onNodeHover(e=>{if(r(u)&&(r(u).style.cursor=e?"pointer":"default"),e){const o=new Set([e.id]),s=r(l).graphData();for(const n of s.links){const d=typeof n.source=="object"?n.source.id:n.source,f=typeof n.target=="object"?n.target.id:n.target;d===e.id&&o.add(f),f===e.id&&o.add(d)}if(p(c,o,!0),g.onNodeHover){const n=r(u)?.querySelector("canvas");if(n){const d=n.getBoundingClientRect(),f=r(l).graph2ScreenCoords(e.x,e.y);g.onNodeHover(e,{x:d.left+f.x,y:d.top+f.y})}}}else p(c,new Set,!0),g.onNodeHover?.(null,{x:0,y:0})}).onNodeClick(e=>{j(e)}).onBackgroundClick(()=>{p(c,new Set,!0)}).warmupTicks(50).cooldownTicks(200).d3AlphaDecay(.05).d3VelocityDecay(.5),!0),r(l).d3Force("charge").strength(-100),r(l).d3Force("link").distance(35);const i=I(.15);r(l).d3Force("gravity",i),g.graphData.nodes.length>0&&(r(l).graphData({nodes:[...g.graphData.nodes],links:[...g.graphData.links]}),setTimeout(()=>r(l)?.zoomToFit(400,40),600));const a=new ResizeObserver(()=>{r(l)&&r(u)&&r(l).width(r(u).clientWidth).height(r(u).clientHeight)});return a.observe(r(u)),()=>a.disconnect()}function I(t){let i=[];function a(e){for(const o of i)o.vx-=o.x*t*e,o.vy-=o.y*t*e}return a.initialize=e=>{i=e},a}function b(t,i){switch(t){case"film-meta":return`rgba(204, 70, 0, ${i})`;case"film-cluster":return`rgba(124, 58, 237, ${i})`;case"film-screening":return`rgba(234, 179, 8, ${i})`;default:return`rgba(69, 65, 61, ${i})`}}function v(t){return Math.sqrt(t.val||2)*3}function D(t,i,a){const e=v(t),o=t.id===g.currentFilmId,s=t.active!==!1,n=r(c).size===0||r(c).has(t.id),d=!s||!n,f=d?R(t.color,.2):t.color;if(o&&!d&&(i.beginPath(),i.arc(t.x,t.y,e+2,0,2*Math.PI),i.fillStyle="rgba(133, 127, 122, 0.15)",i.fill()),i.beginPath(),t.type==="meta-category"?_(i,t.x-e,t.y-e,e*2,e*2,3):t.type==="cluster"?N(i,t.x,t.y,e):t.type==="screening"?P(i,t.x,t.y,e):i.arc(t.x,t.y,e,0,2*Math.PI),i.fillStyle=f,i.fill(),!d&&(t.type==="meta-category"||t.type==="cluster"||t.type==="screening")&&(i.shadowColor=t.color,i.shadowBlur=8,i.fill(),i.shadowBlur=0),(t.type!=="film"||o||r(c).has(t.id))&&!d){const S=Math.max(9,11/a);i.font=`${o?"bold ":""}${S}px sans-serif`,i.textAlign="center",i.textBaseline="top",i.fillStyle=d?"rgba(69,65,61,0.25)":"rgba(69,65,61,0.85)",i.fillText(t.label,t.x,t.y+e+3/a)}}function _(t,i,a,e,o,s){t.moveTo(i+s,a),t.lineTo(i+e-s,a),t.quadraticCurveTo(i+e,a,i+e,a+s),t.lineTo(i+e,a+o-s),t.quadraticCurveTo(i+e,a+o,i+e-s,a+o),t.lineTo(i+s,a+o),t.quadraticCurveTo(i,a+o,i,a+o-s),t.lineTo(i,a+s),t.quadraticCurveTo(i,a,i+s,a),t.closePath()}function N(t,i,a,e){t.moveTo(i,a-e),t.lineTo(i+e,a),t.lineTo(i,a+e),t.lineTo(i-e,a),t.closePath()}function P(t,i,a,e){t.moveTo(i,a-e),t.lineTo(i+e*.866,a+e*.5),t.lineTo(i-e*.866,a+e*.5),t.closePath()}function j(t){if(t.type==="meta-category"){const i=t.id.replace("mc-","");y(`/programme/map?filter=mc-${i}`)}else if(t.type==="cluster"){const i=t.id.replace("cl-","");y(`/programme/map?filter=cl-${i}`)}else if(t.type==="screening"){const i=t.id.replace("sc-","");y(`/programme/map?filter=sc-${i}`)}else t.type==="film"&&t.data?.slug&&y(`/programme/${t.data.slug}`)}z(()=>{r(l)&&(r(c),r(l).nodeColor(r(l).nodeColor()))});var T=L();B(T,t=>p(u,t),()=>r(u)),H(w,T),A()}E.__docgen={data:[{name:"graphData",visibility:"public",keywords:[{name:"required",description:""}],kind:"let",type:{kind:"type",type:"object",text:"GraphData"},static:!1,readonly:!1},{name:"currentFilmId",visibility:"public",keywords:[{name:"required",description:""}],kind:"let",type:{kind:"type",type:"string",text:"string"},static:!1,readonly:!1},{name:"onNodeHover",visibility:"public",keywords:[],kind:"let",type:{kind:"function",text:"(node: GraphNode | null, pos: { x: number; y: number; }) => void"},static:!1,readonly:!1}],name:"MiniGraphView.svelte"};export{E as default};
